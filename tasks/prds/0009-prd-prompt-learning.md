# PRD-0009: Prompt Learning í”¼ë“œë°± ë£¨í”„ ì‹œìŠ¤í…œ

**ë²„ì „**: 1.0.0
**ìƒíƒœ**: Draft
**ê´€ë ¨ ì´ìŠˆ**: [#9](https://github.com/garimto81/archive-analyzer/issues/9)
**ì‘ì„±ì¼**: 2024-11-30

---

## 1. Overview

### 1.1 ë°°ê²½
Claude Codeì˜ CLAUDE.mdëŠ” ì—ì´ì „íŠ¸ ë™ì‘ì„ ì •ì˜í•˜ëŠ” í•µì‹¬ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ì…ë‹ˆë‹¤. í˜„ì¬ëŠ” ìˆ˜ë™ìœ¼ë¡œ ê´€ë¦¬ë˜ë©°, ì‹¤íŒ¨ ì‚¬ë¡€ì—ì„œ í•™ìŠµí•˜ì—¬ ìë™ ê°œì„ í•˜ëŠ” ë©”ì»¤ë‹ˆì¦˜ì´ ì—†ìŠµë‹ˆë‹¤.

### 1.2 ë¬¸ì œì 
- Phase ê²€ì¦ ì¤€ìˆ˜ìœ¨ì´ 60% ìˆ˜ì¤€ìœ¼ë¡œ ë‚®ìŒ
- ë°˜ë³µë˜ëŠ” ì‹¤íŒ¨ íŒ¨í„´ì— ëŒ€í•œ ì²´ê³„ì  ë¶„ì„ ë¶€ì¬
- CLAUDE.md ê°œì„ ì´ ìˆ˜ë™ì ì´ê³  ë¹„íš¨ìœ¨ì 
- ê°œì„  íš¨ê³¼ ì¸¡ì • ë°©ë²• ë¶€ì¬

### 1.3 ì†”ë£¨ì…˜
ê°•í™” í•™ìŠµ(RL) ê¸°ë°˜ Prompt Learning ì‹œìŠ¤í…œì„ êµ¬ì¶•í•˜ì—¬ ì‹¤íŒ¨ ë¶„ì„ â†’ í”¼ë“œë°± ìƒì„± â†’ ìë™ ê°œì„  â†’ íš¨ê³¼ ì¸¡ì •ì˜ í”¼ë“œë°± ë£¨í”„ë¥¼ ìë™í™”í•©ë‹ˆë‹¤.

---

## 2. Goals

### 2.1 Primary Goals
| ëª©í‘œ | í˜„ì¬ | ëª©í‘œì¹˜ | ì¸¡ì • ë°©ë²• |
|------|------|--------|-----------|
| Phase ê²€ì¦ ì¤€ìˆ˜ìœ¨ | 60% | 85% | ìë™ ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸ |
| íƒœìŠ¤í¬ ì™„ë£Œ ì‹œê°„ | 100% | 85% | ì„¸ì…˜ ë¡œê·¸ ë¶„ì„ |
| í† í° ë¹„ìš© | 100% | 80% | API ì‚¬ìš©ëŸ‰ ì¶”ì  |

### 2.2 Secondary Goals
- DSPy ê¸°ë°˜ Phase ê²€ì¦ê¸° ìµœì í™” íŒŒì´í”„ë¼ì¸ êµ¬ì¶•
- Claude Hook ì‹¤ì‹œê°„ ê·œì¹™ ê²€ì¦ ì‹œìŠ¤í…œ êµ¬í˜„
- A/B í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬ êµ¬ì¶•
- CI/CD ìë™ ìµœì í™” ì›Œí¬í”Œë¡œìš° í†µí•©

### 2.3 Non-Goals
- ì™„ì „ ììœ¨ CLAUDE.md ìˆ˜ì • (ì‚¬ëŒ ê²€í†  í•„ìˆ˜)
- ë‹¤ë¥¸ í”„ë¡œì íŠ¸ CLAUDE.md ìµœì í™”
- ì‹¤ì‹œê°„ í”„ë¡¬í”„íŠ¸ ìƒì„± (ì‚¬ì „ ìµœì í™”ë§Œ)

---

## 3. User Stories

### 3.1 ê°œë°œì (Primary User)
```
As a ê°œë°œì
I want to CLAUDE.mdê°€ ì‹¤íŒ¨ ì‚¬ë¡€ì—ì„œ ìë™ìœ¼ë¡œ í•™ìŠµí•˜ê¸°ë¥¼
So that ë°˜ë³µì ì¸ ì‹¤íŒ¨ë¥¼ ì¤„ì´ê³  ìƒì‚°ì„±ì„ ë†’ì¼ ìˆ˜ ìˆë‹¤
```

### 3.2 DevOps ì—”ì§€ë‹ˆì–´
```
As a DevOps ì—”ì§€ë‹ˆì–´
I want to CI/CDì—ì„œ CLAUDE.md ìµœì í™”ê°€ ìë™ ì‹¤í–‰ë˜ê¸°ë¥¼
So that ì§€ì†ì ì¸ í’ˆì§ˆ ê°œì„ ì´ ê°€ëŠ¥í•˜ë‹¤
```

### 3.3 íŒ€ ë¦¬ë”
```
As a íŒ€ ë¦¬ë”
I want to CLAUDE.md ê°œì„  íš¨ê³¼ë¥¼ ì¸¡ì •í•˜ê¸°ë¥¼
So that ROIë¥¼ í‰ê°€í•˜ê³  ë¦¬ì†ŒìŠ¤ íˆ¬ìë¥¼ ê²°ì •í•  ìˆ˜ ìˆë‹¤
```

---

## 4. Technical Requirements

### 4.1 ê¸°ìˆ  ìŠ¤íƒ

| êµ¬ì„±ìš”ì†Œ | ê¸°ìˆ  | ë²„ì „ | ìš©ë„ |
|----------|------|------|------|
| ìµœì í™” í”„ë ˆì„ì›Œí¬ | DSPy | 3.0.4+ | Phase ê²€ì¦ê¸° ìµœì í™” |
| í…ìŠ¤íŠ¸ ê·¸ë˜ë””ì–¸íŠ¸ | TextGrad | 0.1.8+ | ì—ì´ì „íŠ¸ í”„ë¡¬í”„íŠ¸ ê°œì„  |
| ì›Œí¬í”Œë¡œìš° | LangGraph | 0.2+ | ë³‘ë ¬ ë¶„ì„ íŒŒì´í”„ë¼ì¸ |
| ì‹¤ì‹œê°„ ê²€ì¦ | Claude Hook | - | ê·œì¹™ ìœ„ë°˜ ê°ì§€ |
| LLM | Claude Sonnet 4 | - | ë¶„ì„ ë° ìƒì„± |

### 4.2 ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Prompt Learning System                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Claude Hook    â”‚  â”‚     DSPy        â”‚  â”‚    TextGrad     â”‚ â”‚
â”‚  â”‚  (Real-time)    â”‚  â”‚  (Compile-time) â”‚  â”‚   (Test-time)   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â”‚                    â”‚                    â”‚          â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                â–¼                                â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚                    â”‚   CLAUDE.md         â”‚                     â”‚
â”‚                    â”‚   Updater           â”‚                     â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 ëª¨ë“ˆ êµ¬ì¡°

```
src/agents/prompt_learning/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ session_parser.py       # .jsonl ì„¸ì…˜ ë¡œê·¸ íŒŒì‹±
â”œâ”€â”€ failure_analyzer.py     # ì‹¤íŒ¨ ì›ì¸ ë¶„ì„
â”œâ”€â”€ pattern_detector.py     # ë°˜ë³µ íŒ¨í„´ ê°ì§€
â”œâ”€â”€ dspy_optimizer.py       # DSPy ê¸°ë°˜ ìµœì í™”
â”œâ”€â”€ textgrad_optimizer.py   # TextGrad ê¸°ë°˜ ìµœì í™”
â”œâ”€â”€ claude_md_updater.py    # CLAUDE.md ìë™ ì—…ë°ì´íŠ¸
â””â”€â”€ metrics.py              # ì„±ëŠ¥ ì¸¡ì •

.claude/hooks/
â””â”€â”€ claude-md-validator.py  # ì‹¤ì‹œê°„ ê²€ì¦ Hook
```

### 4.4 API ì„¤ê³„

```python
# í•µì‹¬ ì¸í„°í˜ì´ìŠ¤
class PromptLearningSystem:
    def analyze_session(session_id: str) -> FailureAnalysis
    def optimize_validators() -> OptimizationResult
    def propose_update(analysis: FailureAnalysis) -> UpdateProposal
    def apply_update(proposal: UpdateProposal) -> bool
    def rollback() -> bool
    def get_metrics() -> PromptLearningMetrics
```

---

## 5. Implementation Plan

### Phase 1: Claude Hook ê²€ì¦ê¸° (3ì¼)

| íƒœìŠ¤í¬ | ì„¤ëª… | ì‚°ì¶œë¬¼ |
|--------|------|--------|
| 1.1 | Hook ê¸°ë³¸ êµ¬ì¡° êµ¬í˜„ | `claude-md-validator.py` |
| 1.2 | í•µì‹¬ ê·œì¹™ ì •ì˜ | 5ê°œ Critical ê·œì¹™ |
| 1.3 | í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì‘ì„± | `test_claude_md_validator.py` |
| 1.4 | Hook ë“±ë¡ ë° í…ŒìŠ¤íŠ¸ | `settings.json` ì—…ë°ì´íŠ¸ |

### Phase 2: DSPy í†µí•© (2ì£¼)

| íƒœìŠ¤í¬ | ì„¤ëª… | ì‚°ì¶œë¬¼ |
|--------|------|--------|
| 2.1 | Phase Signature ì •ì˜ | `dspy_optimizer.py` |
| 2.2 | í•™ìŠµ ë°ì´í„° ìˆ˜ì§‘ | 50+ PRD ì˜ˆì‹œ |
| 2.3 | MIPROv2 ìµœì í™” ì‹¤í–‰ | ìµœì í™”ëœ ëª¨ë¸ |
| 2.4 | A/B í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬ | `ab_test_validators.py` |

### Phase 3: TextGrad ì ìš© (1ì£¼)

| íƒœìŠ¤í¬ | ì„¤ëª… | ì‚°ì¶œë¬¼ |
|--------|------|--------|
| 3.1 | TextGrad ì„¤ì • | `textgrad_optimizer.py` |
| 3.2 | ì—ì´ì „íŠ¸ í”„ë¡¬í”„íŠ¸ ìµœì í™” | 33ê°œ ì—ì´ì „íŠ¸ ê°œì„  |
| 3.3 | ë°°ì¹˜ ìµœì í™” ìŠ¤í¬ë¦½íŠ¸ | `optimize_all_agents.py` |

### Phase 4: ìë™ í”¼ë“œë°± ë£¨í”„ (2ì£¼)

| íƒœìŠ¤í¬ | ì„¤ëª… | ì‚°ì¶œë¬¼ |
|--------|------|--------|
| 4.1 | ì„¸ì…˜ íŒŒì„œ êµ¬í˜„ | `session_parser.py` |
| 4.2 | ì‹¤íŒ¨ ë¶„ì„ê¸° êµ¬í˜„ | `failure_analyzer.py` |
| 4.3 | CLAUDE.md ì—…ë°ì´í„° êµ¬í˜„ | `claude_md_updater.py` |
| 4.4 | /prompt-learn ì»¤ë§¨ë“œ | `prompt-learn.md` |
| 4.5 | CI/CD ì›Œí¬í”Œë¡œìš° | `prompt-learning.yml` |

---

## 6. Success Metrics

### 6.1 ì •ëŸ‰ì  ì§€í‘œ

| ì§€í‘œ | Baseline | Target | ì¸¡ì • ì£¼ê¸° |
|------|----------|--------|-----------|
| Phase 0 í†µê³¼ìœ¨ | 65% | 90% | ì£¼ê°„ |
| Phase 1 í†µê³¼ìœ¨ | 55% | 80% | ì£¼ê°„ |
| Phase 2 í†µê³¼ìœ¨ | 60% | 85% | ì£¼ê°„ |
| í‰ê·  íƒœìŠ¤í¬ ì™„ë£Œ ì‹œê°„ | 15ë¶„ | 12ë¶„ | ì£¼ê°„ |
| í‰ê·  í† í° ì‚¬ìš©ëŸ‰ | 5000 | 4000 | ì£¼ê°„ |
| Rollback íšŸìˆ˜ | - | <2/ì›” | ì›”ê°„ |

### 6.2 ì •ì„±ì  ì§€í‘œ
- ê°œë°œì ë§Œì¡±ë„ ì¡°ì‚¬ (1-5ì )
- ì—ëŸ¬ ë©”ì‹œì§€ ëª…í™•ì„± í‰ê°€
- ì½”ë“œ í’ˆì§ˆ ê°œì„  ì²´ê°ë„

---

## 7. Risks & Mitigations

| ë¦¬ìŠ¤í¬ | ì˜í–¥ | í™•ë¥  | ì™„í™” ë°©ì•ˆ |
|--------|------|------|-----------|
| ê³¼ì í•© (Overfitting) | ë†’ìŒ | ì¤‘ | ë‹¤ì–‘í•œ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤, A/B í…ŒìŠ¤íŠ¸ |
| ìë™ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜ | ë†’ìŒ | ë‚®ìŒ | ë°±ì—… ì‹œìŠ¤í…œ, ìˆ˜ë™ ê²€í†  í•„ìˆ˜ |
| API ë¹„ìš© ì¦ê°€ | ì¤‘ | ì¤‘ | Haiku ëª¨ë¸ í™œìš©, ë°°ì¹˜ ì²˜ë¦¬ |
| í•™ìŠµ ë°ì´í„° ë¶€ì¡± | ì¤‘ | ë†’ìŒ | í•©ì„± ë°ì´í„° ìƒì„±, ì ì§„ì  ìˆ˜ì§‘ |

---

## 8. Dependencies

### 8.1 ì™¸ë¶€ ì˜ì¡´ì„±
- `dspy-ai>=3.0.4`
- `textgrad>=0.1.8`
- `anthropic>=0.40.0`
- `langgraph>=0.2.0`

### 8.2 ë‚´ë¶€ ì˜ì¡´ì„±
- `src/agents/parallel_workflow.py` - LangGraph ì›Œí¬í”Œë¡œìš°
- `src/agents/config.py` - ëª¨ë¸ í‹°ì–´ë§
- `.claude/agents/*.md` - ì—ì´ì „íŠ¸ í”„ë¡¬í”„íŠ¸

---

## 9. Timeline

```
Week 1-2:   Phase 1 (Claude Hook) + Phase 2 ì‹œì‘
Week 3-4:   Phase 2 ì™„ë£Œ (DSPy í†µí•©)
Week 5:     Phase 3 (TextGrad)
Week 6-7:   Phase 4 (ìë™ í”¼ë“œë°± ë£¨í”„)
Week 8:     í…ŒìŠ¤íŠ¸ ë° ë¬¸ì„œí™”
```

---

## 10. Appendix

### 10.1 ì°¸ê³  ìë£Œ
- [DSPy Documentation](https://dspy.ai/)
- [TextGrad Paper](https://arxiv.org/abs/2406.07496)
- [Arize: CLAUDE.md Prompt Learning](https://arize.com/blog/claude-md-best-practices-learned-from-optimizing-claude-code-with-prompt-learning/)

### 10.2 ê´€ë ¨ íŒŒì¼
- `docs/guides/PROMPT_LEARNING_GUIDE.md` - ìƒì„¸ ê°œë°œ ê°€ì´ë“œ
- `src/agents/prompt_learning/` - êµ¬í˜„ ëª¨ë“ˆ
- `.github/workflows/prompt-learning.yml` - CI/CD ì›Œí¬í”Œë¡œìš°

---

ğŸ¤– Generated with [Claude Code](https://claude.com/claude-code)
