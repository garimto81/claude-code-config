#!/usr/bin/env python3
"""
post-commit hook for Agent/Skill usage analysis

This hook is triggered after every commit and analyzes Claude Code logs
to extract Agent/Skill usage information.
"""

import subprocess
import sys
import os
from pathlib import Path

# Get repository root
repo_root = Path(__file__).parent.parent.parent

# Path to the analysis script
analysis_script = repo_root / ".claude" / "scripts" / "analyze-agent-usage.py"

# Check if the analysis script exists
if not analysis_script.exists():
    # Silently exit if script doesn't exist (not yet implemented)
    sys.exit(0)

# Run analysis in background (non-blocking)
try:
    if os.name == 'nt':  # Windows
        # Use start command to run in background
        subprocess.Popen(
            ["python", str(analysis_script)],
            creationflags=subprocess.CREATE_NO_WINDOW | subprocess.DETACHED_PROCESS,
            stdout=subprocess.DEVNULL,
            stderr=subprocess.DEVNULL
        )
    else:  # Unix-like
        # Use & to run in background
        subprocess.Popen(
            ["python3", str(analysis_script)],
            stdout=subprocess.DEVNULL,
            stderr=subprocess.DEVNULL,
            start_new_session=True
        )
except Exception:
    # Silently fail - don't block the commit
    pass

sys.exit(0)
